<div
  class="fixed inset-0 bg-black bg-opacity-50 z-40"
  (click)="onCancel()"
></div>

<div class="fixed inset-0 z-50 flex items-center justify-center p-4">
  <div
    class="bg-[#F1EDFF] rounded-lg shadow-xl w-full max-w-5xl max-h-[80vh] overflow-y-auto"
    (click)="$event.stopPropagation()"
  >
    <div class="flex items-center justify-between p-6">
      <div>
        <h2 class="text-xl text-gray-900">
          Edit Customer - {{ data.request.customerName }}
        </h2>
        <p class="text-sm text-gray-600 mt-1">
          Update customer configuration and settings
        </p>
      </div>
      <button
        (click)="onCancel()"
        class="text-gray-400 hover:text-gray-600 transition-colors"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          ></path>
        </svg>
      </button>
    </div>

    <form [formGroup]="customerForm" (ngSubmit)="onSubmit()" class="p-6">
      <div class="mb-8">
        <div class="flex items-center mb-4 border-b border-gray-200">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="24px"
            viewBox="0 -960 960 960"
            width="24px"
            fill="#F34E1B"
            class="mr-2"
          >
            <path
              d="m370-80-16-128q-13-5-24.5-12T307-235l-119 50L78-375l103-78q-1-7-1-13.5v-27q0-6.5 1-13.5L78-585l110-190 119 50q11-8 23-15t24-12l16-128h220l16 128q13 5 24.5 12t22.5 15l119-50 110 190-103 78q1 7 1 13.5v27q0 6.5-2 13.5l103 78-110 190-118-50q-11 8-23 15t-24 12L590-80H370Zm70-80h79l14-106q31-8 57.5-23.5T639-327l99 41 39-68-86-65q5-14 7-29.5t2-31.5q0-16-2-31.5t-7-29.5l86-65-39-68-99 42q-22-23-48.5-38.5T533-694l-13-106h-79l-14 106q-31 8-57.5 23.5T321-633l-99-41-39 68 86 64q-5 15-7 30t-2 32q0 16 2 31t7 30l-86 65 39 68 99-42q22 23 48.5 38.5T427-266l13 106Zm42-180q58 0 99-41t41-99q0-58-41-99t-99-41q-59 0-99.5 41T342-480q0 58 40.5 99t99.5 41Zm-2-140Z"
            />
          </svg>
          <h3 class="text-lg font-medium text-orange-600">
            Basic Configuration
          </h3>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Account Group <span class="text-red-500">*</span>
            </label>
            <ng-select
              [items]="(accountGroupOptions$ | async) ?? []"
              bindLabel="label"
              bindValue="value"
              formControlName="accountGroup"
              placeholder="Select account group"
              [clearable]="false"
              [searchable]="true"
              (search)="onSearchAccountGroup($event.term)"
              class="custom-select"
            >
            </ng-select>
            <div
              *ngIf="
                customerForm.get('accountGroup')?.touched &&
                customerForm.get('accountGroup')?.errors
              "
              class="text-red-500 text-xs mt-1"
            >
              <div
                *ngIf="customerForm.get('accountGroup')?.errors?.['required']"
              >
                Account group is required
              </div>

              <div
                *ngIf="customerForm.get('accountGroup')?.errors?.['pattern']"
              >
                Invalid account group format
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Company Code <span class="text-red-500">*</span>
            </label>
            <ng-select
              [items]="companyCodeOptions"
              bindLabel="label"
              bindValue="value"
              formControlName="companyCode"
              placeholder="Select company code"
              [clearable]="false"
              class="custom-select"
            >
            </ng-select>
            <div
              *ngIf="
                customerForm.get('companyCode')?.touched &&
                customerForm.get('companyCode')?.errors
              "
              class="text-red-500 text-xs mt-1"
            >
              <div
                *ngIf="customerForm.get('companyCode')?.errors?.['required']"
              >
                Company code is required
              </div>

              <div *ngIf="customerForm.get('companyCode')?.errors?.['pattern']">
                Invalid company code format
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Sales Organization <span class="text-red-500">*</span>
            </label>
            <ng-select
              [items]="salesOrganizationOptions"
              bindLabel="label"
              bindValue="value"
              formControlName="salesOrganization"
              placeholder="Select sales org"
              [clearable]="false"
              class="custom-select"
            >
            </ng-select>
            <div
              *ngIf="
                customerForm.get('salesOrganization')?.touched &&
                customerForm.get('salesOrganization')?.errors
              "
              class="text-red-500 text-xs mt-1"
            >
              <div
                *ngIf="customerForm.get('salesOrganization')?.errors?.['required']"
              >
                Sales organization is required
              </div>

              <div
                *ngIf="customerForm.get('salesOrganization')?.errors?.['pattern']"
              >
                Invalid sales organization format
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Distribution Channel <span class="text-red-500">*</span>
            </label>
            <ng-select
              [items]="distributionChannelOptions"
              bindLabel="label"
              bindValue="value"
              formControlName="distributionChannel"
              placeholder="Select distribution channel"
              [clearable]="false"
              class="custom-select"
            >
            </ng-select>
            <div
              *ngIf="
                customerForm.get('distributionChannel')?.touched &&
                customerForm.get('distributionChannel')?.errors
              "
              class="text-red-500 text-xs mt-1"
            >
              <div
                *ngIf="customerForm.get('distributionChannel')?.errors?.['required']"
              >
                Distribution Channel is required
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Division <span class="text-red-500">*</span>
            </label>
            <ng-select
              [items]="divisionOptions"
              bindLabel="label"
              bindValue="value"
              formControlName="division"
              placeholder="Select division"
              [clearable]="false"
              class="custom-select"
            >
            </ng-select>
            <div
              *ngIf="
                customerForm.get('division')?.touched &&
                customerForm.get('division')?.errors
              "
              class="text-red-500 text-xs mt-1"
            >
              <div *ngIf="customerForm.get('division')?.errors?.['required']">
                Division is required
              </div>
            </div>
          </div>

          <!-- Customer Group -->
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Customer Group <span class="text-red-500">*</span>
            </label>
            <ng-select
              [items]="customerGroupOptions"
              bindLabel="label"
              bindValue="value"
              formControlName="customerGroup"
              placeholder="Select customer group"
              [clearable]="false"
              class="custom-select"
            >
            </ng-select>
            <div
              *ngIf="
                customerForm.get('customerGroup')?.touched &&
                customerForm.get('customerGroup')?.errors
              "
              class="text-red-500 text-xs mt-1"
            >
              <div
                *ngIf="customerForm.get('customerGroup')?.errors?.['required']"
              >
                Customer Group is required
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sales Configuration Section -->
      <div class="mb-8">
        <div class="flex items-center mb-4 border-b border-gray-200">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="24px"
            class="mr-2"
            viewBox="0 -960 960 960"
            width="24px"
            fill="#F34E1B"
          >
            <path
              d="M40-160v-112q0-34 17.5-62.5T104-378q62-31 126-46.5T360-440q66 0 130 15.5T616-378q29 15 46.5 43.5T680-272v112H40Zm720 0v-120q0-44-24.5-84.5T666-434q51 6 96 20.5t84 35.5q36 20 55 44.5t19 53.5v120H760ZM360-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm400-160q0 66-47 113t-113 47q-11 0-28-2.5t-28-5.5q27-32 41.5-71t14.5-81q0-42-14.5-81T544-792q14-5 28-6.5t28-1.5q66 0 113 47t47 113ZM120-240h480v-32q0-11-5.5-20T580-306q-54-27-109-40.5T360-360q-56 0-111 13.5T140-306q-9 5-14.5 14t-5.5 20v32Zm240-320q33 0 56.5-23.5T440-640q0-33-23.5-56.5T360-720q-33 0-56.5 23.5T280-640q0 33 23.5 56.5T360-560Zm0 320Zm0-400Z"
            />
          </svg>
          <h3 class="text-lg font-medium text-orange-600">
            Sales Configuration
          </h3>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <!-- Sales Office -->
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Sales Office <span class="text-red-500">*</span>
            </label>
            <ng-select
              [items]="salesOfficeOptions"
              bindLabel="label"
              bindValue="value"
              formControlName="salesOffice"
              placeholder="Select sales office"
              [clearable]="false"
              class="custom-select"
            >
            </ng-select>
            <div
              *ngIf="
                customerForm.get('salesOffice')?.touched &&
                customerForm.get('salesOffice')?.errors
              "
              class="text-red-500 text-xs mt-1"
            >
              <div
                *ngIf="customerForm.get('salesOffice')?.errors?.['required']"
              >
                Sales Office is required
              </div>
            </div>
          </div>

          <!-- Sales Hierarchy -->
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Sales Hierarchy <span class="text-red-500">*</span>
            </label>
            <ng-select
              [items]="salesHierarchyOptions"
              bindLabel="label"
              bindValue="value"
              formControlName="salesHierarchy"
              placeholder="Select sales hierarchy"
              [clearable]="false"
              class="custom-select"
            >
            </ng-select>
            <div
              *ngIf="
                customerForm.get('salesHierarchy')?.touched &&
                customerForm.get('salesHierarchy')?.errors
              "
              class="text-red-500 text-xs mt-1"
            >
              <div
                *ngIf="customerForm.get('salesHierarchy')?.errors?.['required']"
              >
                Sales Hierarchy is required
              </div>
            </div>
          </div>

          <!-- Customer Subgroup -->
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Customer Subgroup <span class="text-red-500">*</span>
            </label>
            <ng-select
              [items]="customerSubgroupOptions"
              bindLabel="label"
              bindValue="value"
              formControlName="customerSubgroup"
              placeholder="Select subgroup"
              [clearable]="false"
              class="custom-select"
            >
            </ng-select>
            <div
              *ngIf="
                customerForm.get('customerSubgroup')?.touched &&
                customerForm.get('customerSubgroup')?.errors
              "
              class="text-red-500 text-xs mt-1"
            >
              <div
                *ngIf="customerForm.get('customerSubgroup')?.errors?.['required']"
              >
                Customer Subgroup is required
              </div>
            </div>
          </div>

          <!-- Sub Region -->
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Sub Region</label
            >
            <ng-select
              [items]="subRegionOptions"
              bindLabel="label"
              bindValue="value"
              formControlName="subRegion"
              placeholder="Select sub region"
              [clearable]="true"
              class="custom-select"
            >
            </ng-select>
          </div>

          <!-- Account Assignment Group -->
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Account Assignment Group</label
            >
            <ng-select
              [items]="accountAssignmentGroupOptions"
              bindLabel="label"
              bindValue="value"
              formControlName="accountAssignmentGroup"
              placeholder="Select account assignment group"
              [clearable]="true"
              class="custom-select"
            >
            </ng-select>
          </div>

          <!-- SO -->
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >SO</label
            >
            <ng-select
              [items]="soOptions"
              bindLabel="label"
              bindValue="value"
              formControlName="so"
              placeholder="Select SO"
              [clearable]="true"
              class="custom-select"
            >
            </ng-select>
          </div>
        </div>
      </div>

      <!-- Financial Configuration Section -->
      <div class="mb-8">
        <div class="flex items-center mb-4 border-b border-gray-200">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="mr-2"
            height="24px"
            viewBox="0 -960 960 960"
            width="24px"
            fill="#F34E1B"
          >
            <path
              d="M280-280h80v-280h-80v280Zm160 0h80v-400h-80v400Zm160 0h80v-160h-80v160ZM200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm0-560v560-560Z"
            />
          </svg>
          <h3 class="text-lg font-medium text-orange-600">
            Financial Configuration
          </h3>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <!-- Payment Terms -->
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Payment Terms <span class="text-red-500">*</span>
            </label>
            <ng-select
              [items]="paymentTermsOptions"
              bindLabel="label"
              bindValue="value"
              formControlName="paymentTerms"
              placeholder="Select payment terms"
              [clearable]="false"
              class="custom-select"
            >
            </ng-select>
            <div
              *ngIf="
                customerForm.get('paymentTerms')?.touched &&
                customerForm.get('paymentTerms')?.errors
              "
              class="text-red-500 text-xs mt-1"
            >
              <div
                *ngIf="customerForm.get('paymentTerms')?.errors?.['required']"
              >
                Payment Terms is required
              </div>
            </div>
          </div>

          <!-- Credit Limit -->
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Credit Limit <span class="text-red-500">*</span>
            </label>
            <input
              type="number"
              min="0"
              formControlName="creditLimit"
              placeholder="Enter credit limit"
              step="1"
              onkeydown="return event.key !== 'e' && event.key !== 'E' && event.key !== '-'"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
            />
            <div
              *ngIf="
                customerForm.get('creditLimit')?.touched &&
                customerForm.get('creditLimit')?.errors
              "
              class="text-red-500 text-xs mt-1"
            >
              <div
                *ngIf="customerForm.get('creditLimit')?.errors?.['required']"
              >
                Credit Limit is required
              </div>

              <div *ngIf="customerForm.get('creditLimit')?.errors?.['min']">
                Credit Limit must be greater than or equal to
                {{ customerForm.get('creditLimit')?.errors?.['min'].min }}
              </div>
            </div>
          </div>

          <!-- Currency -->
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Currency <span class="text-red-500">*</span>
            </label>
            <ng-select
              [items]="currencyOptions"
              bindLabel="label"
              bindValue="value"
              formControlName="currency"
              placeholder="Select currency"
              [clearable]="false"
              class="custom-select"
            >
            </ng-select>
            <div
              *ngIf="customerForm.get('currency')?.touched && customerForm.get('currency')?.errors?.['required']"
              class="text-red-500 text-xs mt-1"
            >
              Currency is required
            </div>
          </div>

          <!-- Price List -->
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Price List</label
            >
            <ng-select
              [items]="priceListOptions"
              bindLabel="label"
              bindValue="value"
              formControlName="priceList"
              placeholder="Select price list"
              [clearable]="true"
              class="custom-select"
            >
            </ng-select>
          </div>

          <!-- Reconciliation Account Type -->
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Reconciliation Account Type</label
            >
            <ng-select
              [items]="reconciliationAccountOptions"
              bindLabel="label"
              bindValue="value"
              formControlName="reconciliationAccountType"
              placeholder="Select reconciliation account type"
              [clearable]="true"
              class="custom-select"
            >
            </ng-select>
          </div>
        </div>
      </div>

      <!-- Shipping Configuration Section -->
      <div class="mb-8">
        <div class="flex items-center mb-4 border-b border-gray-200">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="mr-2"
            height="24px"
            viewBox="0 -960 960 960"
            width="24px"
            fill="#F34E1B"
          >
            <path
              d="M440-183v-274L200-596v274l240 139Zm80 0 240-139v-274L520-457v274Zm-80 92L160-252q-19-11-29.5-29T120-321v-318q0-22 10.5-40t29.5-29l280-161q19-11 40-11t40 11l280 161q19 11 29.5 29t10.5 40v318q0 22-10.5 40T800-252L520-91q-19 11-40 11t-40-11Zm200-528 77-44-237-137-78 45 238 136Zm-160 93 78-45-237-137-78 45 237 137Z"
            />
          </svg>
          <h3 class="text-lg font-medium text-orange-600">
            Shipping Configuration
          </h3>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <!-- Incoterms -->
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Incoterms</label
            >
            <ng-select
              [items]="incotermsOptions"
              bindLabel="label"
              bindValue="value"
              formControlName="incoterms"
              placeholder="Select incoterms"
              [clearable]="true"
              class="custom-select"
            >
            </ng-select>
          </div>

          <!-- Shipping Conditions -->
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Shipping Conditions</label
            >
            <ng-select
              [items]="shippingConditionsOptions"
              bindLabel="label"
              bindValue="value"
              formControlName="shippingConditions"
              placeholder="Select conditions"
              class="custom-select"
            >
            </ng-select>
          </div>

          <!-- Delivery Priority -->
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Delivery Priority</label
            >
            <ng-select
              [items]="deliveryPriorityOptions"
              bindLabel="label"
              bindValue="value"
              formControlName="deliveryPriority"
              placeholder="Select priority"
              [searchable]="false"
              class="custom-select"
            >
            </ng-select>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
        <button
          type="button"
          (click)="onCancel()"
          class="px-6 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="px-6 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition-colors"
        >
          Save Changes
        </button>
      </div>
    </form>
  </div>
</div>
